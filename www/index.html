<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="ratchet.css" rel="stylesheet">
    <link href="ratchet-theme.css" rel="stylesheet">

    <script src="cordova.js"></script>
    <script src="force.js"></script>

    <script src="stub.js"></script>
    <script src="VFRemote.js"></script>
    <script src="main.js"></script>
    <script src="VFMetadataSender.js"></script>
    <script src="en_US.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script>

       // var jsonString = `{"Visualforce":{"viewstate":{"ViewstateSender":{}}},"Override":{},"MruHovers":{"SECTION_SELECTOR":"*[data-hovdata]","SECTION_ATTRIBUTE":"data-hovdata","ITEM_SELECTOR":"*[data-hovid]","ITEM_ATTRIBUTE":"data-hovid","URL_LOADER_ELEMENT_ID":"urlQueryStr","URL_LOADER_DATA_ATTRIB_NAME":"data-urlquerystr","dbgRegisterSectionCalled":false,"global_data":{},"_url":null},"Controls":{}}`;

    //    window.sfdcApp = JSON.parse(jsonString);



        (function (UITheme) {
            UITheme.getUITheme = function () {
                return UserContext.uiTheme;
            };
        }(window.UITheme = window.UITheme || {}));

        Visualforce.remoting.Manager.add(new $VFRM.RemotingProviderImpl({
            "vf": {
              "vid": "0667F000008zkyo",
              "xhr": false,
              "dev": false,
              "tst": false,
              "dbg": false,
              "tm": 1552371054122,
              "ovrprm": false
            },
            "actions": {
              "AccountRemoter": {
                "ms": [
                  {
                    "name": "getAccount",
                    "len": 1,
                    "ns": "",
                    "ver": 44,
                    "csrf": "VmpFPSxNakF4T1Mwd015MHhOVlF3TmpveE1EbzFOQzR4TWpKYSxRTGgwTmhGQ1B6VFNDSVU2UkJ2Sl9BLFpqazJOVEV4"
                  },
                  {
                    "name": "getData",
                    "len": 1,
                    "ns": "",
                    "ver": 44,
                    "csrf": "VmpFPSxNakF4T1Mwd015MHhOVlF3TmpveE1EbzFOQzR4TWpKYSxDRXVrU0tSV081VkxhdGU0TkRZamx6LE5HRmlOalE1"
                  },
                  {
                    "name": "insertAccount",
                    "len": 1,
                    "ns": "",
                    "ver": 44,
                    "csrf": "VmpFPSxNakF4T1Mwd015MHhOVlF3TmpveE1EbzFOQzR4TWpKYSx0Y19KUGdvSXFxMUVoQTFaUlJuaF9MLE5UVTVZV0l3"
                  },
                  {
                    "name": "insertAttachments",
                    "len": 1,
                    "ns": "",
                    "ver": 44,
                    "csrf": "VmpFPSxNakF4T1Mwd015MHhOVlF3TmpveE1EbzFOQzR4TWpKYSxRMm8xbjVDU3l4MmlKTEpiWEljTGFILE9UazRNelZr"
                  }
                ],
                "prm": 0
              }
            },
            "service": "apexremote"
          }));
        /* Do login */
        force.login(
            function () {
                console.log("Auth succeeded");
                showUsersList();
            },
            function (error) {
                console.log("Auth failed: " + error);
            }
        );

        /* This method will render a list of users from current salesforce org */
        var showUsersList = function () {

            fetchRecords(function (data) {
                var users = data.records;

                var listItemsHtml = '';
                for (var i = 0; i < users.length; i++) {
                    listItemsHtml += ('<li class="table-view-cell"><div class="media-body">' + users[i].Name + '</div></li>');
                }

                //document.querySelector('#users').innerHTML = listItemsHtml;
            })
        }

        /* This method will fetch a list of user records from salesforce. 
        Just change the soql query to fetch another sobject. */
        var fetchRecords = function (successHandler) {
            var soql = 'SELECT Id, Name FROM User LIMIT 10';
            force.query(soql, successHandler, function (error) {
                alert('Failed to fetch users: ' + error);
            });
        };

        function debugApp(){
            console.log("hey");
            console.log("visualforce",Visualforce);
            console.log("visualforce");
            debugger;

            console.log( force.getAccessToken());

            Visualforce.remoting.oauthAccessToken = force.getAccessToken().access_token;

            Visualforce.remoting.Manager.invokeAction(
                'AccountRemoter.getData',
                'hey', 
                function(result, event){
                    alert('result' + result);
                }, 
                {escape: true}
            );
        }

        if (this.SfdcApp && this.SfdcApp.projectOneNavigator) { SfdcApp.projectOneNavigator.sendTitleToParent('HelloWorld'); }


    </script>
</head>

<body>

        <button onclick="debugApp()">debug application</button>

    <!-- <ul id="users" class="table-view content">

    </ul> -->

    <button onclick="debugApp()">debug application</button>

    <a href="https://c.ap5.visual.force.com/apex/HelloWorld">open vf page</a>
    <a href="https://c.ap5.visual.force.com/apex/tryAngular">open angular try</a>    

</body>
</html>
<script type="text/javascript">  SfdcApp.Visualforce.viewstate.ViewstateSender.sendViewstate('https://ap5.salesforce.com', 'HelloWorld');  </script>
